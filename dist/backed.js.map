{"version":3,"file":"backed.js","sources":["../src/utils.js","../src/internals/fire-event.js","../src/internals/to-js-prop.js","../src/internals/load-script.js","../src/internals/pub-sub.js","../src/internals/pub-sub-loader.js","../src/backed.js"],"sourcesContent":["'use strict';\r\n// import Bind from './bind.js';\r\n\r\nconst handleProperties = (target, properties) => {\r\n  if (properties) {\r\n    for (let property of Object.keys(properties)) {\r\n      const observer = properties[property].observer;\r\n      const strict = properties[property].strict;\r\n      handlePropertyObserver(target, property, strict, observer);\r\n      // Bind(superclass, superclass.properties)\r\n    }\r\n  }\r\n}\r\n\r\nconst handlePropertyObserver = (obj, property, strict, observer) => {\r\n  if (observer && _needsObserverSetup(obj, property)) {\r\n    obj.observedProperties.push(property);\r\n    setupObserver(obj, property, strict, observer)\r\n  }\r\n}\r\n\r\nconst _needsObserverSetup = (obj, property) => {\r\n  if (!obj.observedProperties) {\r\n    obj.observedProperties = [];\r\n  }\r\n  if (obj.observedProperties[property]) {\r\n    console.warn(\r\n      'observer::ignoring duplicate property observer ' + property\r\n    );\r\n    return false;\r\n  } else {\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * Runs a method on target whenever given property changes\r\n *\r\n * example:\r\n * change(change) {\r\n *  change.property // name of the property\r\n *  change.value // value of the property\r\n * }\r\n *\r\n * @arg {object} obj target\r\n * @arg {string} property name\r\n * @arg {boolean} strict\r\n * @arg {method} fn The method to run on change\r\n */\r\nconst setupObserver = (obj, property, strict=false, fn) => {\r\n  Object.defineProperty(obj, property, {\r\n    set(value) {\n      this[`_${property}`] = value;\n      let data = {\r\n        property: property,\r\n        value: value\r\n      };\r\n      this[fn](data);\r\n      PubSub.publish(fn, data);\r\n    },\n    get() {\n      return this[`_${property}`];\n    },\n    configurable: strict ? false : true\r\n  });\r\n}\r\n\r\n\r\nconst handleObservers = (obj, observers) => {\r\n  if (!observers) {\r\n    return;\r\n  }\r\n  for (let observe of observers) {\r\n    let parts = observe.split(/\\(|\\)/g);\r\n    let fn = parts[0];\r\n    parts = parts.slice(1);\r\n    for (let property of parts) {\n      if (property.length) {\r\n        handlePropertyObserver(obj, property, false, fn);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default {\r\n  handleProperties: handleProperties.bind(this),\r\n  handlePropertyObserver: handlePropertyObserver.bind(this),\r\n  handleObservers: handleObservers.bind(this),\r\n  setupObserver: setupObserver.bind(this)\r\n}\r\n","'use strict';\r\n/**\r\n * @mixin backed\r\n * @param {string} type Name of the event\r\n * @param {HTMLElement} target Name of the event\r\n * @param {string|boolean|number|object|array} detail\r\n */\r\nexport default (type=String, detail=null, target=document) => {\r\n  target.dispatchEvent(new CustomEvent(type, {detail: detail}));\r\n};\r\n","'use strict';\r\n/**\r\n * @mixin Backed\r\n *\r\n * some-prop -> someProp\r\n *\r\n * @arg {string} string The content to convert\r\n * @return {string} string\r\n */\r\nexport default string => {\r\n  let parts = string.split('-');\r\n  if (parts.length > 1) {\r\n    var upper = parts[1].charAt(0).toUpperCase();\r\n    string = parts[0] + upper + parts[1].slice(1).toLowerCase();\r\n  }\r\n  return string;\r\n};\r\n","'use strict';\nconst loadScript = src => {\n  return new Promise((resolve, reject) => {\n    let script = document.createElement('script');\n    script.src = src;\n    script.onload = result => {\n      resolve(result);\n    }\n    script.onerror = error => {\n      reject(error);\n    }\n    document.body.appendChild(script);\n  });\n}\nexport default loadScript;\n","'use strict';\r\nexport default class {\r\n\r\n  /**\r\n   * Creates handlers\r\n   */\r\n  constructor() {\r\n    this.handlers = [];\r\n  }\r\n\r\n  /**\r\n   * @param {String} event\r\n   * @param {Method} handler\r\n   * @param {HTMLElement} context\r\n   */\r\n  subscribe(event, handler, context) {\r\n    if (typeof context === 'undefined') {\r\n      context = handler;\r\n    }\r\n    this.handlers.push({event: event, handler: handler.bind(context)});\r\n  }\r\n\r\n  /**\r\n   * @param {String} event\r\n   * @param {String|Number|Boolean|Object|Array} value\r\n   */\r\n  publish(event, value) {\r\n    for (let i = 0; i < this.handlers.length; i++) {\r\n      if (this.handlers[i].event === event) {\r\n        this.handlers[i].handler(event, value, this.handlers[i].oldValue);\r\n        this.handlers[i].oldValue = value;\r\n      }\r\n    }\r\n  }\r\n}\r\n","'use strict';\r\nimport Pubsub from './pub-sub.js';\r\nexport default () => {\r\n  window.PubSub = window.PubSub || new Pubsub();\r\n}\r\n","'use strict';\nimport Utils from './utils';\nimport fireEvent from './internals/fire-event.js';\nimport toJsProp from './internals/to-js-prop.js';\nimport loadScript from './internals/load-script.js';\nimport PubSubLoader from './internals/pub-sub-loader.js';\nPubSubLoader();\n\n/**\n *\n * @module backed\n * @param {class} _class\n */\nexport default _class => {\n  const upperToHyphen = string => {\n    return string.replace(/([A-Z])/g, \"-$1\").toLowerCase().replace('-', '');\n  };\n\n  const isNode= () => {\n    try {\n      return this===global;\n    }catch(e){\n      return false;\n    }\n  };\n\n  const construct = (name, _class) => {\n    if (isNode()) {\n      return _class;\n    } else {\n      customElements.define(name, _class);\n    }\n  }\n\n\n  // get the tagName or try to make one with class.name\n  let name = _class.is || upperToHyphen(_class.name);\n  // Setup properties & mixins\n  // define/register custom-element\n  return construct(name, class extends _class {\n    constructor() {\n      super();\n      this.fireEvent = fireEvent.bind(this);\n      this.toJsProp = toJsProp.bind(this);\n      this.loadScript = loadScript.bind(this);\n\n      Utils.handleProperties(this, _class.properties);\n      Utils.handleObservers(this, _class.observers);\n    }\n  });\n};\n"],"names":["this"],"mappings":"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"}