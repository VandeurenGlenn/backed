{"version":3,"file":"backed.js","sources":["../src/base.js","../src/internals/fire-event.js","../src/internals/to-js-prop.js","../src/internals/load-script.js","../src/internals/pub-sub.js","../src/internals/pub-sub-loader.js","../src/backed.js"],"sourcesContent":["'use strict';\n\r\nconst handleProperties = (target, properties) => {\r\n  if (properties) {\r\n    for (let property of Object.keys(properties)) {\r\n      const observer = properties[property].observer;\r\n      const strict = properties[property].strict;\n      const isGlobal = properties[property].global;\n      handlePropertyObserver(target, property, observer, {\n        strict: strict || false,\n        global: isGlobal || false\n      });\n      // Bind(superclass, superclass.properties)\r\n    }\r\n  }\r\n}\r\n\r\nconst handlePropertyObserver = (obj, property, observer, opts={\n  strict: false, global:false\n}) => {\n\n  if (observer && _needsObserverSetup(obj, property)) {\n    obj.observedProperties.push(property);\n\n    if (opts.global) {\n      PubSub.subscribe(`global.${property}`, obj[observer]);\n    }\n    setupObserver(obj, property, observer, opts)\n  }\r\n}\r\n\r\nconst _needsObserverSetup = (obj, property) => {\r\n  if (!obj.observedProperties) {\r\n    obj.observedProperties = [];\r\n  }\r\n  if (obj.observedProperties[property]) {\r\n    console.warn(\r\n      'observer::ignoring duplicate property observer ' + property\r\n    );\r\n    return false;\r\n  } else {\r\n    return true;\r\n  }\r\n}\n\nconst forObservers = (target, observers, isGlobal=false) => {\n  for (let observe of observers) {\n    let parts = observe.split(/\\(|\\)/g);\n    let fn = parts[0];\n    parts = parts.slice(1);\n    for (let property of parts) {\n      if (property.length) {\n        handlePropertyObserver(target, property, fn, {\n          strict: false,\n          global: isGlobal\n        });\n      }\n    }\n  }\n}\n\r\n/**\r\n * Runs a method on target whenever given property changes\r\n *\r\n * example:\r\n * change(change) {\r\n *  change.property // name of the property\r\n *  change.value // value of the property\r\n * }\r\n *\r\n * @arg {object} obj target\r\n * @arg {string} property name\r\n * @arg {boolean} strict\r\n * @arg {method} fn The method to run on change\r\n */\r\nconst setupObserver = (obj, property, fn, opts={\n  strict: false, global: false\n}) => {\n  Object.defineProperty(obj, property, {\r\n    set(value) {\n      this[`_${property}`] = value;\n      let data = {\r\n        property: property,\r\n        value: value\r\n      };\n      if (opts.global) {\n        data.instance = this;\n        PubSub.publish(`global.${property}`, data);\n      } else {\n        this[fn](data);\n      }\n    },\n    get() {\n      return this[`_${property}`];\n    },\n    configurable: opts.strict\n  });\n}\r\n\r\n\r\nconst handleObservers = (target, observers=[], globalObservers=[]) => {\n  if (!observers && !globalObservers) {\n    return;\r\n  }\n  forObservers(target, observers);\n}\r\n\r\nexport default {\r\n  handleProperties: handleProperties.bind(this),\r\n  handlePropertyObserver: handlePropertyObserver.bind(this),\r\n  handleObservers: handleObservers.bind(this),\r\n  setupObserver: setupObserver.bind(this)\r\n}\r\n","'use strict';\r\n/**\r\n * @mixin backed\r\n * @param {string} type Name of the event\r\n * @param {HTMLElement} target Name of the event\r\n * @param {string|boolean|number|object|array} detail\r\n */\r\nexport default (type=String, detail=null, target=document) => {\r\n  target.dispatchEvent(new CustomEvent(type, {detail: detail}));\r\n};\r\n","'use strict';\r\n/**\r\n * @mixin Backed\r\n *\r\n * some-prop -> someProp\r\n *\r\n * @arg {string} string The content to convert\r\n * @return {string} string\r\n */\r\nexport default string => {\r\n  let parts = string.split('-');\r\n  if (parts.length > 1) {\r\n    var upper = parts[1].charAt(0).toUpperCase();\r\n    string = parts[0] + upper + parts[1].slice(1).toLowerCase();\r\n  }\r\n  return string;\r\n};\r\n","'use strict';\nconst loadScript = src => {\n  return new Promise((resolve, reject) => {\n    let script = document.createElement('script');\n    script.src = src;\n    script.onload = result => {\n      resolve(result);\n    }\n    script.onerror = error => {\n      reject(error);\n    }\n    document.body.appendChild(script);\n  });\n}\nexport default loadScript;\n","'use strict';\r\nexport default class {\r\n\r\n  /**\r\n   * Creates handlers\r\n   */\r\n  constructor() {\r\n    this.handlers = [];\r\n  }\r\n\r\n  /**\r\n   * @param {String} event\r\n   * @param {Method} handler\r\n   * @param {HTMLElement} context\r\n   */\r\n  subscribe(event, handler, context) {\r\n    if (typeof context === 'undefined') {\r\n      context = handler;\r\n    }\r\n    this.handlers.push({event: event, handler: handler.bind(context)});\r\n  }\r\n\r\n  /**\r\n   * @param {String} event\r\n   * @param {String|Number|Boolean|Object|Array} change\n   */\r\n  publish(event, change) {\n    for (let i = 0; i < this.handlers.length; i++) {\r\n      if (this.handlers[i].event === event) {\n        let oldValue = this.handlers[i].oldValue || {};\n        // dirty checking value, ensures that we don't create a loop\n        if (oldValue.value !== change.value) {\n          this.handlers[i].handler(change, this.handlers[i].oldValue);\n          this.handlers[i].oldValue = change;\n        }\n      }\r\n    }\r\n  }\r\n}\r\n","'use strict';\r\nimport Pubsub from './pub-sub.js';\nexport default isWindow => {\n  if (isWindow) {\n    window.PubSub = window.PubSub || new Pubsub();\n  } else {\n    global.PubSub = global.PubSub || new Pubsub();\n  }\n}\r\n","'use strict';\r\nimport base from './base.js';\nimport fireEvent from './internals/fire-event.js';\r\nimport toJsProp from './internals/to-js-prop.js';\r\nimport loadScript from './internals/load-script.js';\r\nimport PubSubLoader from './internals/pub-sub-loader.js';\r\nconst supportsCustomElementsV1 = 'customElements' in window;\nconst supportsCustomElementsV0 = 'registerElement' in document;\n\nconst isWindow = () => {\n  try {\r\n    return window;\n  } catch(e) {\n    return false;\r\n  }\r\n};\n\r\n/**\r\n *\r\n * @module backed\r\n * @param {class} _class\r\n */\r\nexport default _class => {\r\n  const upperToHyphen = string => {\r\n    return string.replace(/([A-Z])/g, \"-$1\").toLowerCase().replace('-', '');\r\n  };\n\r\n  // get the tagName or try to make one with class.name\r\n  let name = _class.is || upperToHyphen(_class.name);\r\n  // Setup properties & observers\n\n    if (isWindow()) {\n      if (supportsCustomElementsV1) {\n        let klass = class extends _class {\n          constructor() {\n            super();\n            this.created();\n          }\n          created() {\n            PubSubLoader(isWindow());\n            this.fireEvent = fireEvent.bind(this);\n            this.toJsProp = toJsProp.bind(this);\n            this.loadScript = loadScript.bind(this);\n\n            base.handleProperties(this, _class.properties);\n            base.handleObservers(this, _class.observers, _class.globalObservers);\n          }\n        }\n        customElements.define(name, klass);\n      } else if (supportsCustomElementsV0) {\n        let klass = class extends _class {\n          createdCallback() {\n            this.created();\n          }\n          created() {\n            PubSubLoader(isWindow());\n            this.fireEvent = fireEvent.bind(this);\n            this.toJsProp = toJsProp.bind(this);\n            this.loadScript = loadScript.bind(this);\n\n            base.handleProperties(this, _class.properties);\n            base.handleObservers(this, _class.observers, _class.globalObservers);\n          }\n        }\n        document.registerElement(name, klass)\n      } else {\n        console.warn('classes::unsupported');\n      }\n    } else {\n      return _class;\n    }\n};\r\n"],"names":["this"],"mappings":"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"}